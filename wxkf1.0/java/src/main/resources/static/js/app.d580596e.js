(function(e){function t(t){for(var o,n,i=t[0],r=t[1],l=t[2],d=0,f=[];d<i.length;d++)n=i[d],Object.prototype.hasOwnProperty.call(a,n)&&a[n]&&f.push(a[n][0]),a[n]=0;for(o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);c&&c(t);while(f.length)f.shift()();return u.push.apply(u,l||[]),s()}function s(){for(var e,t=0;t<u.length;t++){for(var s=u[t],o=!0,i=1;i<s.length;i++){var r=s[i];0!==a[r]&&(o=!1)}o&&(u.splice(t--,1),e=n(n.s=s[0]))}return e}var o={},a={app:0},u=[];function n(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=o,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],r=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=r;u.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";s("85ec")},"517e":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var o=s("2b0e"),a=s("5c96"),u=s.n(a),n=(s("0fae"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("HelloWorld")],1)}),i=[],r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"main"},[""==e.curKfId?s("div",{staticClass:"main_up"},[""==e.curKfName?s("div",[s("el-button",{on:{click:function(t){return e.openDialog("登录")}}},[e._v("登录")])],1):s("div",[e._v(" "+e._s(this.curKfName)+" "),s("el-button",{attrs:{type:"info"},on:{click:e.loginOut}},[e._v("退出登录")])],1)]):s("div",{staticClass:"main_down"},[s("div",{staticClass:"left"},[s("div",{staticClass:"left_up"},[s("div",{class:1==e.curStatus?"label_title label_title_active":"label_title",on:{click:function(t){return e.getSessionList(1)}}},[e._v(" 当前会话 ")]),s("div",{class:0==e.curStatus?"label_title label_title_active":"label_title",on:{click:function(t){return e.getSessionList(0)}}},[e._v(" 历史会话 ")])]),s("div",{staticClass:"left_down"},e._l(e.sessionList,(function(t){return s("div",{key:t.id,class:e.curUserId==t.userId?"box_select":"box"},[s("div",{staticClass:"box_left",on:{click:function(s){return e.startSession(t.userId,t.unReadCount=0)}}},[e._v(" "+e._s(t.listName)+" ")]),s("div",{staticClass:"right_left"},[s("div",{staticClass:"right_left_count"},[e._v(" "+e._s(t.unReadCount>0?t.unReadCount:"")+" ")]),s("div",{staticClass:"right_left_del"},[s("i",{staticClass:"el-icon-close",on:{click:function(s){return e.delSession(t.userId)}}})])])])})),0)]),s("div",{staticClass:"right"},[s("div",{ref:"element",staticClass:"up",attrs:{id:"msg_end"}},e._l(e.list,(function(t,o){return s("div",{key:o,class:1===t.source?"msg_right":"msg_left"},[s("div",{staticClass:"msg_right_up"},[e._v(" "+e._s(1===t.source?t.kfName:t.userName)+" "+e._s(t.createTime)+" ")]),s("div",{class:1===t.source?"msg_right_down":"msg_left_down"},[e._v(" "+e._s(t.content)+" ")])])})),0),s("div",{staticClass:"down"},[s("el-input",{attrs:{type:"textarea",rows:9,placeholder:"请输入内容，回车发送！"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMsg(t)}},model:{value:e.textarea,callback:function(t){e.textarea=t},expression:"textarea"}})],1)])]),s("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-input",{attrs:{placeholder:"请输入用户名..."},model:{value:e.loginName,callback:function(t){e.loginName=t},expression:"loginName"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.login}},[e._v("确 定")])],1)],1)],1)},l=[],c=s("bc3a"),d=s.n(c),f={name:"HelloWorld",data:function(){return{dialogVisible:!1,dialogTitle:"",loginName:"",textarea:"",list:[],curKfId:"",curKfName:"",curUserId:"",curUserName:"",sessionList:[],curStatus:1}},created:function(){},updated:function(){var e=document.getElementById("msg_end");null!=e&&(e.scrollTop=e.scrollHeight)},destroyed:function(){this.websocketclose()},methods:{initWebSocket:function(e,t){this.websock=new WebSocket("ws://127.0.0.1:1997/websocket/"+e+"/"+t),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonopen:function(){console.log("WebSocket连接成功")},websocketonerror:function(e){console.log("WebSocket连接发生错误",e)},websocketonmessage:function(e){var t=JSON.parse(e.data);1==t.status?this.list.push(t.data):(this.curStatus=1,this.sessionList=t.data)},websocketclose:function(e){null!=this.curKfId&&""!=this.curKfId&&(null!=this.curUserId?this.initWebSocket(this.curKfId,this.curUserId):this.initWebSocket(this.curKfId,99999999)),console.log("connection closed",e),console.log(e)},sendMsg:function(){if(0==this.curStatus)return this.$message.error("历史会话不可以发消息!");if(this.curUserId,"99999999"==this.curUserId)return this.$message.error("请选择左边的对话框开始聊天!");var e={kfId:this.curKfId,kfName:this.curKfName,content:this.textarea,userName:this.curUserName,userId:this.curUserId,createTime:this.getCurDate(),source:1};this.list.push(e),this.textarea="";var t=this;d.a.post("http://127.0.0.1:1997/msg/send",e).then((function(e){if(console.log(e.data),-1==e.data.code)return t.$message.error(e.data.errDesc)})).catch((function(e){console.log(e)}))},openDialog:function(e){this.dialogTitle=e,this.dialogVisible=!0},login:function(){var e=this;"登录"==this.dialogTitle&&d.a.get("http://127.0.0.1:1997/user/login?kfName="+this.loginName).then((function(t){if(console.log(t.data),-1==t.data.code)return e.$message.error(t.data.errDesc);e.curKfId=t.data.data.id,e.curKfName=t.data.data.kfName,e.dialogVisible=!1,e.getSessionList(1),e.startSession(99999999)})).catch((function(e){console.log(e)}))},getSessionList:function(e){this.curStatus=e;var t=this;d.a.get("http://127.0.0.1:1997/session/list?kfId="+this.curKfId+"&status="+this.curStatus).then((function(e){if(-1==e.data.code)return t.$message.error(e.data.errDesc);t.sessionList=e.data.data,t.startSession(99999999)})).catch((function(e){console.log(e)}))},createSession:function(e,t){var s=this;d.a.get("http://127.0.0.1:1997/createSession?id="+this.curKfId+"&toUserId="+e+"&toUserName="+t).then((function(e){if(-1==e.data.code)return s.$message.error(e.data.errDesc)})).catch((function(e){console.log(e)}))},startSession:function(e){console.log(this.websock),void 0!=this.websock&&this.websock.close(),this.curUserId=e,this.initWebSocket(this.curKfId,e),this.msgList()},delSession:function(e){var t=this;d.a.get("http://127.0.0.1:1997/session/close?userId="+e).then((function(e){if(-1==e.data.code)return t.$message.error(e.data.errDesc);t.getSessionList(t.curStatus)})).catch((function(e){console.log(e)}))},loginOut:function(){var e=this;d.a.get("http:////127.0.0.1:1997/loginOut?name="+this.curKfName).then((function(t){return-1==t.data.code?e.$message.error(t.data.errDesc):(e.curKfId="",e.curKfName="",e.$message.success("退出登录成功"))})).catch((function(e){console.log(e)}))},msgList:function(){var e=this;d.a.get("http://127.0.0.1:1997/msg/list?openId="+this.curUserId).then((function(t){if(-1==t.data.code)return e.$message.error(t.data.errDesc);e.list=t.data.data})).catch((function(e){console.log(e)}))},getCurDate:function(){var e=new Date,t=e.getFullYear(),s=e.getMonth()+1<10?"0"+e.getMonth():e.getMonth(),o=e.getDate(),a=e.getHours(),u=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),n=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return console.log(t+"-"+s+"-"+o+" "+a+":"+u+":"+n),t+"-"+s+"-"+o+" "+a+":"+u+":"+n}}},g=f,p=(s("fb35"),s("2877")),h=Object(p["a"])(g,r,l,!1,null,"14ad4d40",null),m=h.exports,b={name:"App",components:{HelloWorld:m}},v=b,k=(s("034f"),Object(p["a"])(v,n,i,!1,null,null,null)),_=k.exports;o["default"].use(u.a),o["default"].use(a["Pagination"]),o["default"].use(a["Dialog"]),o["default"].use(a["Autocomplete"]),o["default"].use(a["Dropdown"]),o["default"].use(a["DropdownMenu"]),o["default"].use(a["DropdownItem"]),o["default"].use(a["Menu"]),o["default"].use(a["Submenu"]),o["default"].use(a["MenuItem"]),o["default"].use(a["MenuItemGroup"]),o["default"].use(a["Input"]),o["default"].use(a["InputNumber"]),o["default"].use(a["Radio"]),o["default"].use(a["RadioGroup"]),o["default"].use(a["RadioButton"]),o["default"].use(a["Checkbox"]),o["default"].use(a["CheckboxButton"]),o["default"].use(a["CheckboxGroup"]),o["default"].use(a["Switch"]),o["default"].use(a["Select"]),o["default"].use(a["Option"]),o["default"].use(a["OptionGroup"]),o["default"].use(a["Button"]),o["default"].use(a["ButtonGroup"]),o["default"].use(a["Table"]),o["default"].use(a["TableColumn"]),o["default"].use(a["DatePicker"]),o["default"].use(a["TimeSelect"]),o["default"].use(a["TimePicker"]),o["default"].use(a["Popover"]),o["default"].use(a["Tooltip"]),o["default"].use(a["Breadcrumb"]),o["default"].use(a["BreadcrumbItem"]),o["default"].use(a["Form"]),o["default"].use(a["FormItem"]),o["default"].use(a["Tabs"]),o["default"].use(a["TabPane"]),o["default"].use(a["Tag"]),o["default"].use(a["Tree"]),o["default"].use(a["Alert"]),o["default"].use(a["Slider"]),o["default"].use(a["Icon"]),o["default"].use(a["Row"]),o["default"].use(a["Col"]),o["default"].use(a["Upload"]),o["default"].use(a["Progress"]),o["default"].use(a["Spinner"]),o["default"].use(a["Badge"]),o["default"].use(a["Card"]),o["default"].use(a["Rate"]),o["default"].use(a["Steps"]),o["default"].use(a["Step"]),o["default"].use(a["Carousel"]),o["default"].use(a["CarouselItem"]),o["default"].use(a["Collapse"]),o["default"].use(a["CollapseItem"]),o["default"].use(a["Cascader"]),o["default"].use(a["ColorPicker"]),o["default"].use(a["Transfer"]),o["default"].use(a["Container"]),o["default"].use(a["Header"]),o["default"].use(a["Aside"]),o["default"].use(a["Main"]),o["default"].use(a["Footer"]),o["default"].use(a["Timeline"]),o["default"].use(a["TimelineItem"]),o["default"].use(a["Link"]),o["default"].use(a["Divider"]),o["default"].use(a["Image"]),o["default"].use(a["Calendar"]),o["default"].use(a["Backtop"]),o["default"].use(a["PageHeader"]),o["default"].use(a["CascaderPanel"]),o["default"].use(a["Loading"].directive),o["default"].prototype.$loading=a["Loading"].service,o["default"].prototype.$msgbox=a["MessageBox"],o["default"].prototype.$alert=a["MessageBox"].alert,o["default"].prototype.$confirm=a["MessageBox"].confirm,o["default"].prototype.$prompt=a["MessageBox"].prompt,o["default"].prototype.$notify=a["Notification"],o["default"].prototype.$message=a["Message"],o["default"].config.productionTip=!1,new o["default"]({render:function(e){return e(_)}}).$mount("#app")},"85ec":function(e,t,s){},fb35:function(e,t,s){"use strict";s("517e")}});
//# sourceMappingURL=app.d580596e.js.map